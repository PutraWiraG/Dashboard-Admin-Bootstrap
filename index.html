<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Dashboard Admin</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous" />

    <!-- Bootstrap Icon -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.10.3/font/bootstrap-icons.css" />

    <!-- Read Sxcel JS -->
    <script src="https://unpkg.com/read-excel-file@4.x/bundle/read-excel-file.min.js"></script>

    <!-- Style CSS -->
    <link rel="stylesheet" href="style/style.css" />
  </head>
  <body>
    <!-- Navbar -->
    <nav class="navbar navbar-expand-lg shadow-sm fixed-top" style="background-color: var(--bs-body-bg)">
      <div class="container justify-content-center pt-3 pb-3">
        <h2>Dashboard Admin</h2>
      </div>
    </nav>
    <!-- Akhir Navbar -->

    <!-- Section -->
    <section>
      <!-- Container -->
      <div class="container-fluid">
        <!-- Row -->
        <div class="row">
          <!-- Col -->
          <div class="col-3">
            <div class="navbar-left padding vh-100 shadow-sm sticky-top">
              <div class="container menu">
                <div class="row ms-3 mb-4">
                  <div class="col">
                    <div class="kotak">
                      <a href="#dashboard"><i class="bi bi-house-door-fill me-3"></i> Dashboard</a>
                    </div>
                  </div>
                </div>
                <div class="row ms-3 mb-4">
                  <div class="col">
                    <div class="kotak">
                      <a href="#form"><i class="bi bi-ui-checks-grid me-3"></i> Form</a>
                    </div>
                  </div>
                </div>
                <div class="row ms-3 mb-4">
                  <div class="col">
                    <div class="kotak">
                      <a href="#chart"><i class="bi bi-bar-chart-line-fill me-3"></i> Chart</a>
                    </div>
                  </div>
                </div>
                <div class="row ms-3">
                  <div class="col">
                    <div class="teks-footer ms-4">
                      <p>Created with <i class="bi bi-heart-fill text-primary"></i> by <a href="https://www.instagram.com/putra_wir22" class="text-dark fw-bold">Putra Wira</a></p>
                    </div>
                  </div>
                </div>
              </div>
            </div>
          </div>
          <!-- Akhir Col -->
          <!-- Col -->
          <div class="col-9" style="background-color: #f7f7f7">
            <!-- Dashboard -->
            <section id="dashboard" class="padding">
              <div class="container">
                <div class="row mb-4">
                  <div class="col">
                    <h2>Dashboard</h2>
                  </div>
                </div>
                <div class="row mb-4">
                  <div class="col-md-4 mb-3">
                    <div class="kotak-dashboard shadow-sm">
                      <p>Total Mahasiswa</p>
                      <i class="bi bi-people-fill"></i> 50.000
                    </div>
                  </div>
                  <div class="col-md-4 mb-3">
                    <div class="kotak-dashboard shadow-sm">
                      <p>Total Dosen</p>
                      <i class="bi bi-person-badge-fill"></i> 9.231
                    </div>
                  </div>
                  <div class="col-md-4 mb-3">
                    <div class="kotak-dashboard shadow-sm">
                      <p>Fakultas</p>
                      <i class="bi bi-building-fill"></i> 12
                    </div>
                  </div>
                  <div class="col-md-4 mb-3">
                    <div class="kotak-dashboard shadow-sm">
                      <p>Jurusan</p>
                      <i class="bi bi-book-fill"></i> 31
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col-md-5">
                    <div class="mb-3">
                      <label for="formFile" class="form-label">Import Excel</label>
                      <input class="form-control input-excel" type="file" id="formFile" />
                    </div>
                  </div>
                </div>
                <div class="row">
                  <div class="col">
                    <table class="table table-primary table-hover tbl-excel">
                      <thead>
                        <tr>
                          <th scope="col">No</th>
                          <th scope="col">Nama</th>
                          <th scope="col">Npm</th>
                          <th scope="col">Fakultas</th>
                          <th scope="col">Jurusan</th>
                        </tr>
                      </thead>
                    </table>
                  </div>
                </div>
              </div>
            </section>
            <!-- Akhir Dashboard -->

            <!-- Form -->
            <section id="form" class="padding">
              <div class="container">
                <div class="row mb-4">
                  <div class="col">
                    <h2>Form</h2>
                  </div>
                </div>
                <div class="row">
                  <div class="col">
                    <div class="card">
                      <div class="card-body">
                        <h5 class="card-title mb-4">Input Data Mahasiswa</h5>
                        <div class="alert alert-primary alert-dismissible fade show d-none" role="alert">
                          <strong>Sukses!</strong> Data Berhasil diSimpan.
                          <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
                        </div>
                        <form name="submit-to-google-sheet">
                          <div class="mb-3">
                            <label for="nama" class="form-label">Nama Mahasiswa</label>
                            <input type="text" class="form-control nama" name="nama" />
                          </div>
                          <div class="mb-3">
                            <label for="npm" class="form-label">NPM</label>
                            <input type="text" class="form-control npm" name="npm" />
                          </div>
                          <div class="mb-3">
                            <label for="fakultas" class="form-label">Fakultas</label>
                            <input type="text" class="form-control fakultas" name="fakultas" />
                          </div>
                          <div class="mb-3">
                            <label for="jurusan" class="form-label">Jurusan</label>
                            <input type="text" class="form-control jurusan" name="jurusan" />
                          </div>
                          <button type="submit" class="btn btn-primary btn-kirim">Submit</button>
                          <button class="btn btn-primary btn-loading d-none" type="button" disabled>
                            <span class="spinner-border spinner-border-sm" role="status" aria-hidden="true"></span>
                            Loading...
                          </button>
                        </form>
                      </div>
                    </div>
                  </div>
                </div>
              </div>
            </section>
            <!-- Akhir Form -->

            <!-- Chart -->
            <section id="chart" class="padding">
              <div class="container">
                <div class="row mb-4">
                  <div class="col">
                    <h2>Chart</h2>
                  </div>
                </div>

                <div class="row mb-4">
                  <div class="col-md-6">
                    <div class="card">
                      <canvas id="myChart"></canvas>
                    </div>
                  </div>
                  <div class="col-md-6">
                    <div class="card">
                      <canvas id="piechart"></canvas>
                    </div>
                  </div>
                </div>
              </div>
            </section>
            <!-- Akhir Chart -->
          </div>
          <!-- Akhir Col -->
        </div>
        <!-- Akhir Row -->
      </div>
      <!-- Akhir Container -->
    </section>
    <!-- Akhir Section -->

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js" integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>

    <script>
      // Read Excel
      const inputExcel = document.querySelector(".input-excel");
      const tblExcel = document.querySelector(".tbl-excel");

      inputExcel.addEventListener("change", function () {
        readXlsxFile(inputExcel.files[0]).then(function (data) {
          let i = 0;
          data.map((row, index) => {
            if (i > 0) {
              generateTableRows(tblExcel, row);
            }
            i++;
          });
        });
      });

      function generateTableRows(table, data) {
        let newRow = table.insertRow(-1);
        data.map((row, index) => {
          let newCell = newRow.insertCell();
          let newText = document.createTextNode(row);
          newCell.appendChild(newText);
        });
      }
      // Akhir Read Excel

      // Chart JS
      const ctx = document.getElementById("myChart");
      const pie = document.getElementById("piechart");

      new Chart(ctx, {
        type: "line",
        data: {
          labels: ["Red", "Blue", "Yellow", "Green", "Purple", "Orange"],
          datasets: [
            {
              label: "# of Votes",
              data: [12, 19, 3, 5, 2, 3],
              borderWidth: 1,
            },
          ],
        },
        options: {
          scales: {
            y: {
              beginAtZero: true,
            },
          },
        },
      });

      new Chart(pie, {
        type: "doughnut",
        data: {
          labels: ["Red", "Blue", "Yellow"],
          datasets: [
            {
              label: "# of Votes",
              data: [12, 19, 3],
              borderWidth: 1,
            },
          ],
        },
      });
      // Akhir Chart js

      // Input Excel
      const scriptURL = "https://script.google.com/macros/s/AKfycbwB1UKekqf0DrJWCQiWsdLVzEuTwPFxNThBYuQpuXsZPZVKYGtz74WQ_BdP9_63EO0Axg/exec";
      const form = document.forms["submit-to-google-sheet"];

      const btnKirim = document.querySelector(".btn-kirim");
      const btnLoading = document.querySelector(".btn-loading");
      const myAlert = document.querySelector(".alert");

      form.addEventListener("submit", (e) => {
        e.preventDefault();

        btnLoading.classList.toggle("d-none");
        btnKirim.classList.toggle("d-none");

        fetch(scriptURL, { method: "POST", body: new FormData(form) })
          .then((response) => {
            btnLoading.classList.toggle("d-none");
            btnKirim.classList.toggle("d-none");
            myAlert.classList.toggle("d-none");
            form.reset();
            console.log("Success!", response);
          })
          .catch((error) => console.error("Error!", error.message));
      });
      // Akhir Input Excel
    </script>
  </body>
</html>
